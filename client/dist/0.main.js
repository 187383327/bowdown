(window.webpackJsonp=window.webpackJsonp||[]).push([[0],[,function(e,t,n){"use strict";n.r(t);var o=n(2),i=n(5),a=n.n(i),c=new(n(6).a),r=n(3),s=n.n(r),l=n(7),d=n.n(l),u=n(8),p=n.n(u),m=n(9),g=n.n(m),w=n(10),h=n.n(w),f=n(11),b=n.n(f),y=n(12),v=n.n(y),x=new o.eb,k=[];c.load(s.a,function(e){var t=e.scene;t.position.y-=10,x.add(t),k.push(t)});let L=[];L.push(new o.L({map:(new o.kb).load(d.a)})),L.push(new o.L({map:(new o.kb).load(p.a)})),L.push(new o.L({map:(new o.kb).load(g.a)})),L.push(new o.L({map:(new o.kb).load(h.a)})),L.push(new o.L({map:(new o.kb).load(b.a)})),L.push(new o.L({map:(new o.kb).load(v.a)}));for(let e=0;e<6;e++)L[e].side=o.c;let A=new o.e(1e3,1e3,1e3),S=new o.K(A,L);var M;x.add(S),x.add(((M=new o.r(16777215,10209703)).color.setHSL(.6,1,.8),M.groundColor.setHSL(.095,1,.75),M.position.set(0,50,0),M.visible=!0,M)),x.add(function(){var e=new o.l;e.color.setHSL(.1,1,.95),e.position.set(-1,1.75,1),e.position.multiplyScalar(30),e.castShadow=!0,e.shadow.mapSize.width=2048,e.shadow.mapSize.height=2048;return e.shadow.camera.left=-50,e.shadow.camera.right=50,e.shadow.camera.top=50,e.shadow.camera.bottom=-50,e.shadow.camera.far=3500,e.shadow.bias=-1e-4,e.visible=!0,e}());var z=new o.sb({antialias:!0,alpha:!0});z.setClearColor("#e5e5e5"),screen.width<screen.height?z.setSize(window.innerHeight,window.innerWidth,!1):z.setSize(window.innerWidth,window.innerHeight,!1),z.setPixelRatio(window.devicePixelRatio),z.gammaOutput=!0,z.gammaFactor=2.2;const j=!1;function B(e,t){if(j){var n=new o.p;n.vertices.push(t,new o.pb);var i=new o.y({color:16711680}),a=new o.x(n,i);a.name="collision line",e.gltf.scene.add(a)}}function E(e,t){var n;return e.gltf.animations.forEach(e=>{e.name!==t||(n=e)}),null==n&&console.error("animation: "+t+" cannot be found!"),n}function F(e,t){t.mixer=e,t.anim={idle:e.clipAction(E(t,"Idle")),running:e.clipAction(E(t,"Running best")),runWithBow:e.clipAction(E(t,"Running with bow best")),runWithLegsOnly:e.clipAction(E(t,"Running legs only")),jumping:e.clipAction(E(t,"Jumping2")).setLoop(o.G),equipBow:e.clipAction(E(t,"Equip Bow")).setLoop(o.G),drawBow:e.clipAction(E(t,"Draw bow")).setLoop(o.G),fireBow:e.clipAction(E(t,"Fire bow")).setLoop(o.G)},t.anim.drawBow.clampWhenFinished=!0,t.toggleBow=function(e){t.gltf.scene.children[0].children[1].visible=!e,t.gltf.scene.children[0].children[2].visible=e},t.activeActions=[],t.playAction=function(e){t.anim[e]&&(t.anim[e].reset().play(),this.activeActions.includes(e)||this.activeActions.push(e))},t.stopAction=function(e){this.activeActions.includes(e)?(this.activeActions=this.activeActions.filter(t=>t!=e),t.anim[e].stop()):console.error("tried to stop action: "+e+", but action was never started")},t.bowAction=function(e){t.anim&&t.anim[e]?t.activeBowAction!=e&&(t.activeBowAction&&(this.stopAction(t.activeBowAction),t.activeBowAction=null),t.activeMovement&&"runWithLegsOnly"!=t.activeMovement&&this.stopAction(t.activeMovement),e&&this.playAction(e),t.activeBowAction=e):console.error("action: "+e+" does not exist!")},t.movementAction=function(e="idle"){if(t.anim&&t.anim[e]){if(t.activeMovement){if(t.activeMovement==e)return;this.stopAction(t.activeMovement)}this.playAction(e),t.activeMovement=e}else console.error("action: "+e+" does not exist!")},t.isRunning=function(){return!!t.activeMovement&&t.activeMovement.toLowerCase().includes("run")},t.isFiring=function(){return t.bowState&&("drawn"==t.bowState||"drawing"==t.bowState||"firing"==t.bowState)},t.getPosition=function(){if(t.gltf)return t.gltf.scene.position;console.error("archer.gltf has not been defined yet")},t.getRotation=function(){if(t.gltf)return t.gltf.scene.rotation;console.error("archer.gltf has not been defined yet")}}const O=new WebSocket("ws://ec2-18-191-136-250.us-east-2.compute.amazonaws.com:18181");function P(e){1==O.readyState?O.send(JSON.stringify(e)):console.error("error connecting to server")}O.onmessage=function(e){var t,n;if((e=JSON.parse(e.data)).players&&C.init(e.players),e.player){var i=e.player;i==U?e.damage?G.takeDamage(e.damage):e.kills&&ye(e.kills):e.chatMessage?function(e){var t=document.createTextNode(e),n=document.createElement("p").appendChild(t);document.getElementById("chat").appendChild(n)}(e.chatMessage):"disconnected"===e.status?(x.remove(C.get(i).gltf.scene),C.get(i)):C.get(i)?C.get(i).gltf&&e.position&&null!=e.rotation&&C.move(i,e.position,e.rotation,e.movementAction,e.bowAction):C.add(i,e.position,e.race)}else e.arrow&&(t=e.arrow,(n=I(t.origin,t.rotation)).velocity=new o.pb(t.velocity.x,t.velocity.y,t.velocity.z),R.push(n),T(n,(Date.now()-t.timeOfShoot)/1e3))};n(4);var C={},W={},q=[];C.all=function(){return W},C.get=e=>W[e],C.add=function(e,t,n){W[e]={},null==n&&(console.error("race is undefined"),n="brown"),c.load("./models/benji_"+n+".gltf",function(n){W[e].gltf=n,F(new o.b(n.scene),W[e]),t&&C.move(e,t,0),x.add(n.scene);var i=new o.K(new o.e(.5,2,.5));i.position.y+=1,i.material.visible=!1,n.scene.add(i),i.playerUuid=e,q.push(i)})},C.init=function(e){Object.keys(e).forEach(t=>{C.add(t,e[t].position,e[t].race)})},C.move=function(e,t,n,o,i){var a=W[e];a.gltf.scene.position.copy(t),a.gltf.scene.rotation.y=n,o&&a.movementAction(o),i&&a.bowAction(i)};var _=[],R=[],D=.06,H=.75;function I(e,t){var n=new o.e(D,D,H),i=new o.L({color:65280}),a=new o.K(n,i);return a.origin=e,a.position.copy(e),a.rotation.copy(t),x.add(a),a}function T(e,t){e.velocity.y-=9*t,e.position.add(e.velocity.clone().multiplyScalar(t))}function X(e){_.forEach(t=>{if(!t.stopped){!function(e){(e.position.x>500||e.position.x<-500||e.position.y>500||e.position.y<-500||e.position.z>500||e.position.z<-500)&&(e.stopped=!0)}(t),T(t,e);var n=new o.pb(0,0,1);n.applyEuler(t.rotation).normalize();var i=t.position.clone().sub(t.origin).length()/2,a=new o.cb(t.position,n,0,i),c=a.intersectObjects(q);if(c.length>0){var r=c.pop();t.position.copy(r.point),t.stopped=!0,function(e){P({player:e,damage:100})}(r.object.playerUuid)}(c=a.intersectObjects(k,!0)).length>0&&(t.position.copy(c.pop().point),t.stopped=!0)}}),R.forEach(t=>{T(t,e)})}const Y=n(4);var J,U="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}),G={};G.race=["black","brown","white"][Math.floor(3*Math.random())],c.load(Y("./benji_"+G.race+".gltf"),e=>{G.gltf=e,G.velocity=new o.pb,G.bowState="unequipped",G.addToWorld=function(){x.add(this.gltf.scene),P({player:U,position:G.getPosition(),race:G.race}),G.equipBow(),G.idle()},F(J=new o.b(e.scene),G),J.addEventListener("finished",e=>{"Draw bow"==e.action.getClip().name?G.bowState="drawn":("Fire bow"==e.action.getClip().name&&(G.bowState="equipped"),G.idle())}),G.falling=function(e){if(e){var t=G.getPosition().clone().add(G.velocity.clone().multiplyScalar(e));t.y-=.1;var n=new o.pb(0,1,0),i=new o.cb(t,n,0,.2+Math.abs(G.velocity.y*e)).intersectObjects(k,!0);return!(i.length>0)||(G.getPosition().copy(i[i.length-1].point),!1)}},G.collisionDetected=function(e){var t;t=G,j&&t.gltf.scene.children.forEach(e=>{"collision line"===e.name&&t.gltf.scene.remove(e)});for(var n=-1;n<=1;n++)for(var i=-1;i<=1;i++){n*=.5,i*=.5;var a=new o.pb(n,1,i);a=a.clone().normalize();var c=new o.cb(new o.pb(e.x,e.y,e.z),a,0,a.length());if(B(G,a),c.intersectObjects(k,!0).length>0)return a}return!1},G.playBowAction=function(e){G.isRunning()&&"runWithLegsOnly"!=G.activeMovement?G.movementAction("runWithLegsOnly"):G.activeMovement&&(G.stopAction(G.activeMovement),G.activeMovement=null),G.bowAction(e),G.broadcast()},G.onMouseDown=function(){"unequipped"==G.bowState?G.equipBow():(this.activeActions.includes("jumping")&&this.stopAction("jumping"),G.playBowAction("drawBow"),G.bowState="drawing",Q.zoomIn())},G.onMouseUp=function(){"drawn"==G.bowState?(G.playBowAction("fireBow"),function(){var e=G.getPosition().clone().add(new o.pb(0,1.5,0)),t=I(e,Q.rotation),n=new o.cb;n.setFromCamera({x:0,y:0},Q);var i,a=n.intersectObjects(k.concat(q),!0);a.length>0?i=a[0].point.sub(e):(i=new o.pb,Q.getWorldDirection(i)),t.velocity=i.normalize().multiplyScalar(60),_.push(t),P({arrow:{origin:t.position,rotation:t.rotation,velocity:t.velocity,timeOfShoot:Date.now()}})}(),G.bowState="firing",Q.zoomOut()):"drawing"===G.bowState&&(G.stopAction(G.activeBowAction),G.activeBowAction=null,G.bowState="equipped",G.idle(),Q.zoomOut())},G.broadcast=async function(){P({player:U,position:G.getPosition(),rotation:G.getRotation().y,movementAction:G.activeMovement,bowAction:G.activeBowAction,bowState:G.bowState})},G.runOrSprint=function(e){return e.keyboard.shift?(this.isRunning()&&(this.anim[this.activeMovement].timeScale=1.3),9.1):(this.anim[this.activeMovement]&&(this.anim[this.activeMovement].timeScale=1),7)},G.doubleJumped=!1,G.animate=function(e,t){var n,i=G.falling(e);if(!i){G.doubleJumped=!1;var a=function(e,t){var n=new o.pb;Q.getWorldDirection(n),(n=new o.ob(n.x,n.z)).normalize().multiplyScalar(t*G.runOrSprint(e));var i=0,a=0;if(0!=e.touch.x&&0!=e.touch.y){var c=new o.ob(e.touch.x,e.touch.y);c.length()>100?e.keyboard.shift=!0:e.keyboard.shift=!1,c.normalize(),i=c.x,a=c.y}return e.keyboard.forward&&(i+=0,a+=1),e.keyboard.backward&&(i+=0,a+=-1),e.keyboard.left&&(i+=-1,a+=0),e.keyboard.right&&(i+=1,a+=0),n.rotateAround(new o.ob,Math.atan2(i,a))}(t,e),c=Math.atan2(a.x,a.y);if(0!=t.touch.x&&0!=t.touch.y||t.keyboard.forward||t.keyboard.backward||t.keyboard.left||t.keyboard.right)if(t.jump)G.velocity.x=a.x/e,G.velocity.z=a.y/e;else{G.velocity.set(0,0,0),(n=G.getPosition().clone()).z+=a.y,n.x+=a.x;var r=new o.pb(n.x,n.y+1,n.z),s=new o.cb(r,new o.pb(0,-1,0),0,1).intersectObjects(k,!0);s.length>0&&(n.y=s[0].point.y+.01),G.isRunning()||("equipped"==G.bowState?G.movementAction("runWithBow"):G.isFiring()?G.movementAction("runWithLegsOnly"):G.movementAction("running"))}else if(G.isRunning()&&(G.isFiring()?(G.stopAction(G.activeMovement),G.activeMovement=null):G.idle()),G.isFiring()){a=new o.pb;Q.getWorldDirection(a),c=Math.atan2(a.x,a.z),G.getRotation().y=c,Q.updateCamera(),G.broadcast()}}if(t.jump&&!G.doubleJumped&&(t.jump=null,i&&(G.doubleJumped=!0),G.velocity.y=5,this.playAction("jumping")),i||n||G.velocity.x||G.velocity.y||G.velocity.z){n||(n=G.getPosition().clone()),n.add(G.velocity.clone().multiplyScalar(e));var l=G.collisionDetected(n);if(l)i?(G.velocity.copy(l.clone().negate().normalize().multiplyScalar(10)),n.add(G.velocity.clone().multiplyScalar(e)),G.getPosition().copy(n)):G.velocity.set(0,0,0);else{if(i){var d=10;G.doubleJumped&&G.isFiring()&&(d=5),G.velocity.y-=e*d}if(G.getPosition().copy(n),G.isFiring()){a=new o.pb;Q.getWorldDirection(a),c=Math.atan2(a.x,a.z)}else null==c&&(c=G.getRotation().y);G.getRotation().y=c,Q.updateCamera()}G.broadcast()}},G.idle=function(){G.movementAction("idle"),G.broadcast()},G.equipBow=function(){G.bowState="equipped",G.playBowAction("equipBow"),G.toggleBow(!0)},G.unequipBow=function(){G.toggleBow(!1),G.bowState="unequipped"},G.takeDamage=function(){ve(),G.getPosition().y-=20},G.respawn=function(){G.getPosition().copy(new o.pb)},G.sendChat=function(e){P({player:U,chatMessage:e})}});var N,K;window.innerWidth<window.innerHeight?(N=window.innerHeight,K=window.innerWidth):(N=window.innerWidth,K=window.innerHeight);var Q=new o.U(75,N/K,.1,3e3);Q.zoomState="out";var V=Q.getFocalLength(),Z=Q.getFocalLength()+16;Q.position.z=5;var $=new o.pb,ee=0,te=0;Q.nextPosition=function(e){if(null!=G){var t=new o.pb;return t.x=$.x+e*Math.sin(ee*Math.PI/360)*Math.cos(te*Math.PI/360),t.y=$.y+e*Math.sin(te*Math.PI/360),t.z=$.z+e*Math.cos(ee*Math.PI/360)*Math.cos(te*Math.PI/360),t}},Q.zoomIn=function(){Q.zoomState="zooming in"},Q.zoomOut=function(){Q.zoomState="zooming out"},Q.resetFocalLength=function(){V=Q.getFocalLength(),Z=Q.getFocalLength()+16},Q.resetFocalLength(),Q.animate=function(e){if("zooming in"==Q.zoomState){if(Q.getFocalLength()<Z){var t=60;G.doubleJumped&&(t/=2),(n=Q.getFocalLength()+e*t)<Z?Q.setFocalLength(n):(Q.setFocalLength(Z),Q.zoomState="in")}}else if("zooming out"==Q.zoomState){var n;if(Q.getFocalLength()>V)(n=Q.getFocalLength()-60*e)>V?Q.setFocalLength(n):(Q.setFocalLength(V),Q.zoomState="out")}},Q.setPosition=function(e){Q.position.copy(e)},Q.updateCamera=function(){if(null!=G){var e=G.getPosition().clone().sub(Q.position.clone()),t=new o.pb(-e.z,e.y,e.x).normalize().multiplyScalar(.5);$.copy(G.getPosition().clone().add(t)).setY(G.getPosition().y+1.8);var n=Q.nextPosition(3.5),i=new o.cb($,n.clone().sub($).normalize(),0,3.5).intersectObjects(k,!0);i.length>0&&(n=i[0].point.clone().sub(n.clone().sub(i[0].point).normalize().multiplyScalar(.1))),Q.setPosition(n)}Q.lookAt($),Q.updateMatrix()},Q.moveCamera=function(e,t){ee-=.2*e;var n=te+.2*t;180>n&&n>-140&&(te=n),Q.updateCamera()},n.d(t,"start",function(){return Me}),n.d(t,"gameOver",function(){return ve}),n.d(t,"setKillCount",function(){return ye});var ne=new o.i;window.addEventListener("resize",function(){var e,t;e=window.innerWidth,t=window.innerHeight,ue&&window.innerWidth>window.innerHeight?(ue=!1,document.body.classList.remove("rotated")):ue&&(e=window.innerHeight,t=window.innerWidth);z.setSize(e,t,!1),Q.aspect=e/t,Q.resetFocalLength(),Q.updateProjectionMatrix()});var oe={keyboard:{forward:!1,backward:!1,left:!1,right:!1,space:!1},touch:{x:0,y:0}},ie="playing",ae=!1,ce={id:null,x:null,y:null,shoot:!1},re={id:null,x:null,y:null},se={id:null};const le=4,de=[document.getElementById("shoot-button"),document.getElementById("jump-button")];var ue;function pe(){requestAnimationFrame(pe);var e=ne.getDelta();X(e),G&&J&&(G.animate(e,oe),J.update(e)),Object.keys(C.all()).length&&function(e){Object.keys(W).forEach(t=>{W[t].mixer&&W[t].mixer.update(e)})}(e),Q.animate(e),z.render(x,Q)}function me(e,t){if("string"==typeof e.key)switch(e.key.toLowerCase()){case"w":oe.keyboard.forward=t;break;case"a":oe.keyboard.left=t;break;case"s":oe.keyboard.backward=t;break;case"d":oe.keyboard.right=t;break;case" ":null!=oe.jump?oe.jump=t:t||(oe.jump=!1);break;case"shift":oe.keyboard.shift=t}}function ge(e){13===e.keyCode&&document.getElementById("chat").classList.contains("chatting")&&G.sendChat(document.getElementById("chat-text-box").value),me(e,!0)}function we(e){me(e,!1)}function he(){"chat"==event.target.id?event.target.classList.add("chatting"):2!=event.button&&("paused"==ie?(document.body.requestPointerLock&&document.body.requestPointerLock(),be()):"playing"==ie&&G.onMouseDown())}function fe(){"playing"===ie&&G.onMouseUp()}function be(){document.body.classList.remove("ready"),document.body.classList.add("playing"),ie="playing"}function ye(e){e,document.getElementById("kill-count").innerHTML+="X"}function ve(){ie="gameOver",document.body.classList.remove("playing"),document.getElementById("title").innerHTML="Game over",document.body.classList.remove("playing"),document.body.classList.add("gameOver")}function xe(){ie=document.pointerLockElement?"playing":"paused"}function ke(e){e!=ae&&(e?de.forEach(e=>e.setAttribute("style","display: block;")):de.forEach(e=>e.setAttribute("style","display: none;")),ae=e)}function Le(e){var t,n,o;e.preventDefault(),ke(!0);for(var i=0;i<e.targetTouches.length;i++)e.targetTouches.item(i).identifier==ce.id?t=e.targetTouches.item(i):e.targetTouches.item(i).identifier==re.id?n=e.targetTouches.item(i):null==o&&(o=e.targetTouches.item(i));t?(ue?Q.moveCamera(le*(t.pageY-ce.y),-1*le*(t.pageX-ce.x)):Q.moveCamera(le*(t.pageX-ce.x),le*(t.pageY-ce.y)),ce.x=t.pageX,ce.y=t.pageY):o&&("shoot-button"===o.target.id&&(G.onMouseDown(),ce.shoot=!0),"jump-button"===o.target.id&&(oe.jump=!0,se.id=o.identifier),(ue&&o.pageY>window.innerHeight/2||!ue&&o.pageX>window.innerWidth/2)&&(ce.id=o.identifier,ce.x=o.pageX,ce.y=o.pageY)),n?ue?(oe.touch.y=n.pageX-re.x,oe.touch.x=n.pageY-re.y):(oe.touch.x=n.pageX-re.x,oe.touch.y=-1*(n.pageY-re.y)):o&&(ue&&o.pageY<window.innerHeight/2||!ue&&o.pageX<window.innerWidth/2)&&(re.id=o.identifier,re.x=o.pageX,re.y=o.pageY)}function Ae(e){ce.id==e.changedTouches[0].identifier?(ce.id==se.id&&(oe.jump=!1),ce.shoot&&G.onMouseUp(),ce.id=null,ce.shoot=!1):re.id==e.changedTouches[0].identifier&&(re.id=null,oe.touch={x:0,y:0})}function Se(e){"shoot-button"!=e.target.id&&"jump-button"!=e.target.id&&ke(!1);var t=e.movementX||e.mozMovementX||e.webkitMovementX||0,n=e.movementY||e.mozMovementY||e.webkitMovementY||0;Q.moveCamera(t,n)}function Me(){document.addEventListener("mousemove",Se),document.addEventListener("keydown",ge),document.addEventListener("keyup",we),document.addEventListener("mousedown",he),document.addEventListener("mouseup",fe),document.addEventListener("pointerlockchange",xe),document.addEventListener("touchstart",Le),document.addEventListener("touchmove",Le),document.addEventListener("touchend",Ae),document.body.appendChild(z.domElement),de.concat(z.domElement).forEach(e=>new a.a.Manager(e,{recognizers:[[a.a.Pinch,{enable:!0}]]})),window.innerWidth<window.innerHeight&&document.body.requestPointerLock&&document.body.requestPointerLock()&&screen.orientation.type&&screen.orientation.type.includes("portrait")&&(document.body.requestFullscreen?document.body.requestFullscreen():document.body.mozRequestFullScreen?document.body.mozRequestFullScreen():document.body.webkitRequestFullscreen?document.body.webkitRequestFullscreen():document.body.msRequestFullscreen&&document.body.msRequestFullscreen(),document.body.classList.add("rotated"),ue=!0),G.addToWorld(),pe(),be()}oe.jump=0,document.getElementById("respawn").onclick=function(){G.respawn(),be()}},,function(e,t,n){e.exports=n.p+"models/env.glb"},function(e,t,n){var o={"./Characters_Black.png":13,"./Characters_Brown.png":14,"./Characters_White.png":15,"./benji.bin":16,"./benji.gltf":17,"./benji_black.gltf":18,"./benji_brown.gltf":19,"./benji_white.gltf":20,"./env.glb":3};function i(e){var t=a(e);return n(t)}function a(e){if(!n.o(o,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return o[e]}i.keys=function(){return Object.keys(o)},i.resolve=a,e.exports=i,i.id=4},,,function(e,t,n){e.exports=n.p+"skybox/heather_ft.jpg"},function(e,t,n){e.exports=n.p+"skybox/heather_bk.jpg"},function(e,t,n){e.exports=n.p+"skybox/heather_up.jpg"},function(e,t,n){e.exports=n.p+"skybox/heather_dn.jpg"},function(e,t,n){e.exports=n.p+"skybox/heather_rt.jpg"},function(e,t,n){e.exports=n.p+"skybox/heather_lf.jpg"},function(e,t,n){e.exports=n.p+"models/Characters_Black.png"},function(e,t,n){e.exports=n.p+"models/Characters_Brown.png"},function(e,t,n){e.exports=n.p+"models/Characters_White.png"},function(e,t,n){e.exports=n.p+"models/benji.bin"},function(e,t,n){e.exports=n.p+"models/benji.gltf"},function(e,t,n){e.exports=n.p+"models/benji_black.gltf"},function(e,t,n){e.exports=n.p+"models/benji_brown.gltf"},function(e,t,n){e.exports=n.p+"models/benji_white.gltf"}]]);