(window.webpackJsonp=window.webpackJsonp||[]).push([[0],[,function(e,t,n){"use strict";n.r(t);var o=n(2),i=new(n(3).a),a=n(4),c=n.n(a),r=n(5),s=n.n(r),d=n(6),l=n.n(d),u=n(7),p=n.n(u),w=n(8),m=n.n(w),g=n(9),b=n.n(g),y=n(10),v=n.n(y),h=new o.eb,f=[];i.load(c.a,function(e){var t=e.scene;t.position.y-=10,h.add(t),f.push(t)});let x=[];x.push(new o.L({map:(new o.kb).load(s.a)})),x.push(new o.L({map:(new o.kb).load(l.a)})),x.push(new o.L({map:(new o.kb).load(p.a)})),x.push(new o.L({map:(new o.kb).load(m.a)})),x.push(new o.L({map:(new o.kb).load(b.a)})),x.push(new o.L({map:(new o.kb).load(v.a)}));for(let e=0;e<6;e++)x[e].side=o.c;let k=new o.e(1e3,1e3,1e3),L=new o.K(k,x);var z;h.add(L),h.add(((z=new o.r(16777215,10209703)).color.setHSL(.6,1,.8),z.groundColor.setHSL(.095,1,.75),z.position.set(0,50,0),z.visible=!0,z)),h.add(function(){var e=new o.l;e.color.setHSL(.1,1,.95),e.position.set(-1,1.75,1),e.position.multiplyScalar(30),e.castShadow=!0,e.shadow.mapSize.width=2048,e.shadow.mapSize.height=2048;return e.shadow.camera.left=-50,e.shadow.camera.right=50,e.shadow.camera.top=50,e.shadow.camera.bottom=-50,e.shadow.camera.far=3500,e.shadow.bias=-1e-4,e.visible=!0,e}());var S=new o.sb({antialias:!0,alpha:!0});function M(e,t){var n;return e.gltf.animations.forEach(e=>{e.name!==t||(n=e)}),null==n&&console.error("animation: "+t+" cannot be found!"),n}function A(e,t){t.mixer=e,t.anim={idle:e.clipAction(M(t,"Idle")),running:e.clipAction(M(t,"Running best")),runWithBow:e.clipAction(M(t,"Running with bow best")),runWithLegsOnly:e.clipAction(M(t,"Running legs only")),jumping:e.clipAction(M(t,"Jumping")).setLoop(o.G),equipBow:e.clipAction(M(t,"Equip Bow")).setLoop(o.G),drawBow:e.clipAction(M(t,"Draw bow")).setLoop(o.G),fireBow:e.clipAction(M(t,"Fire bow")).setLoop(o.G)},t.anim.drawBow.clampWhenFinished=!0,t.toggleBow=function(e){t.gltf.scene.children[0].children[1].visible=!e,t.gltf.scene.children[0].children[2].visible=e},t.bowAction=function(e){t.anim&&t.anim[e]?t.activeBowAction!=e&&(t.activeBowAction&&t.anim[t.activeBowAction].stop(),t.activeMovement&&"runWithLegsOnly"!=t.activeMovement&&t.anim[t.activeMovement].stop(),e&&t.anim[e].reset().play(),t.activeBowAction=e):console.error("action: "+e+" does not exist!")},t.movementAction=function(e="idle"){if(t.anim&&t.anim[e]){if(t.activeMovement){if(t.activeMovement==e)return;t.anim[t.activeMovement].stop()}t.anim[e].reset().play(),t.activeMovement=e}else console.error("action: "+e+" does not exist!")},t.isRunning=function(){return!!t.activeMovement&&t.activeMovement.toLowerCase().includes("run")},t.isFiring=function(){return t.bowState&&("drawn"==t.bowState||"drawing"==t.bowState||"firing"==t.bowState)}}S.setClearColor("#e5e5e5"),screen.width<screen.height?S.setSize(window.innerHeight,window.innerWidth,!1):S.setSize(window.innerWidth,window.innerHeight,!1),S.setPixelRatio(window.devicePixelRatio),S.gammaOutput=!0,S.gammaFactor=2.2;const B=new WebSocket("ws://ec2-18-191-136-250.us-east-2.compute.amazonaws.com:18181");function F(e){B.readyState&&B.send(JSON.stringify(e))}B.onmessage=function(e){var t,n;if((e=JSON.parse(e.data)).players&&E.init(e.players),e.player){var i=e.player;i==Y?e.damage&&X.takeDamage(e.damage):e.chatMessage?function(e){var t=document.createTextNode(e),n=document.createElement("p").appendChild(t);document.getElementById("chat").appendChild(n)}(e.chatMessage):"disconnected"===e.status?(h.remove(E.get(i).scene),E.get(i)):E.get(i)?E.get(i).gltf&&e.position&&null!=e.rotation&&E.move(i,e.position,e.rotation,e.movementAction,e.bowAction):E.add(i,e.position,e.race)}else e.arrow&&(t=e.arrow,(n=R(t.origin,t.rotation)).velocity=new o.pb(t.velocity.x,t.velocity.y,t.velocity.z),q.push(n),D(n,(Date.now()-t.timeOfShoot)/1e3))};var E={},P={},O=[];E.all=function(){return P},E.get=e=>P[e],E.add=function(e,t,n){P[e]={},i.load("./models/benji_"+n+".gltf",function(n){P[e].gltf=n,A(new o.b(n.scene),P[e]),t&&E.move(e,t,0),h.add(n.scene);var i=new o.K(new o.e(.5,2,.5));i.position.y+=1,i.material.visible=!1,n.scene.add(i),i.playerUuid=e,O.push(i)})},E.init=function(e){Object.keys(e).forEach(t=>{E.add(t,new o.pb(e[t].x,e[t].y,e[t].z),e[t].race)})},E.move=function(e,t,n,o,i){var a=P[e];a.gltf.scene.position.copy(t),a.gltf.scene.rotation.y=n,o&&a.movementAction(o),i&&a.bowAction(i)};var W=[],q=[],j=.06,C=.75;function R(e,t){var n=new o.e(j,j,C),i=new o.L({color:65280}),a=new o.K(n,i);return a.origin=e,a.position.copy(e),a.rotation.copy(t),h.add(a),a}function D(e,t){e.velocity.y-=9*t,e.position.add(e.velocity.clone().multiplyScalar(t))}function H(e){W.forEach(t=>{if(!t.stopped){!function(e){(e.position.x>500||e.position.x<-500||e.position.y>500||e.position.y<-500||e.position.z>500||e.position.z<-500)&&(e.stopped=!0)}(t),D(t,e);var n=new o.pb(0,0,1);n.applyEuler(t.rotation).normalize();var i=t.position.clone().sub(t.origin).length()/2,a=new o.cb(t.position,n,0,i),c=a.intersectObjects(O);if(c.length>0){var r=c.pop();t.position.copy(r.point),t.stopped=!0,function(e){F({player:e,damage:100})}(r.object.playerUuid)}(c=a.intersectObjects(f,!0)).length>0&&(t.position.copy(c.pop().point),t.stopped=!0)}}),q.forEach(t=>{D(t,e)})}var I,Y="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}),X={};const T=.12;X.race=["black","brown","white"][Math.floor(3*Math.random())],i.load("./models/benji_"+X.race+".gltf",e=>{X.gltf=e,X.velocity=new o.pb,X.bowState="unequipped",h.add(e.scene),A(I=new o.b(e.scene),X),I.addEventListener("finished",e=>{"Draw bow"==e.action.getClip().name?X.bowState="drawn":("Fire bow"==e.action.getClip().name&&(X.bowState="equipped"),X.moveAction("idle"))}),X.getPosition=function(){return X.gltf.scene.position},X.getRotation=function(){return X.gltf.scene.rotation},F({player:Y,position:X.getPosition(),race:X.race}),X.falling=function(e){if(e){var t=X.getPosition().clone().add(X.velocity.clone().multiplyScalar(e));t.y-=.1;var n=new o.pb(0,1,0),i=new o.cb(t,n,0,.2+Math.abs(X.velocity.y*e)).intersectObjects(f,!0);return!(i.length>0)||(X.getPosition().copy(i[i.length-1].point),!1)}};X.collisionDetected=function(e){for(var t=-1;t<=1;t++)for(var n=-1;n<=1;n++){t*=.5,n*=.5;var i=new o.pb(t,1,n);if(i=i.clone().normalize(),new o.cb(new o.pb(e.x,e.y,e.z),i,0,i.length()).intersectObjects(f,!0).length>0)return!0}return!1},X.moveAction=function(e){X.movementAction(e),X.broadcast()},X.playBowAction=function(e){X.isRunning()&&"runWithLegsOnly"!=X.activeMovement?X.moveAction("runWithLegsOnly"):X.activeMovement&&(X.anim[X.activeMovement].stop(),X.activeMovement=null),X.bowAction(e),X.broadcast()},X.onMouseDown=function(){"unequipped"==X.bowState?X.equipBow():(X.playBowAction("drawBow"),X.bowState="drawing",J.zoomIn())},X.onMouseUp=function(){"drawn"==X.bowState?(X.playBowAction("fireBow"),X.anim.drawBow.stop(),function(){var e=X.getPosition().clone().add(new o.pb(0,1.5,0)),t=R(e,J.rotation),n=new o.cb;n.setFromCamera({x:0,y:0},J);var i,a=n.intersectObjects(f.concat(O),!0);a.length>0?i=a[0].point.sub(e):(i=new o.pb,J.getWorldDirection(i)),t.velocity=i.normalize().multiplyScalar(60),W.push(t),F({arrow:{origin:t.position,rotation:t.rotation,velocity:t.velocity,timeOfShoot:Date.now()}})}(),X.bowState="firing",J.zoomOut()):"drawing"===X.bowState&&(X.anim.drawBow.stop(),X.anim[X.activeBowAction].stop(),X.activeBowAction=null,X.bowState="equipped",X.moveAction("idle"),J.zoomOut())},X.broadcast=async function(){F({player:Y,position:X.getPosition(),rotation:X.getRotation().y,movementAction:X.activeMovement,bowAction:X.activeBowAction,bowState:X.bowState})},X.move=function(e,t=X.getRotation().y){if(X.collisionDetected(e))X.velocity.set(0,0,0);else{if(X.getPosition().copy(e),X.isFiring()){var n=new o.pb;J.getWorldDirection(n),t=Math.atan2(n.x,n.z)}X.getRotation().y=t,J.updateCamera(),X.broadcast()}},X.animate=function(e,t){var n;if(X.falling(e))X.velocity.y-=10*e;else{var i=function(e){var t=new o.pb;J.getWorldDirection(t),(t=new o.ob(t.x,t.z)).normalize().multiplyScalar(T);var n=0,i=0;if(0!=e.touch.x&&0!=e.touch.y){var a=new o.ob(e.touch.x,e.touch.y).normalize();n=a.x,i=a.y}return e.keyboard.forward&&(n+=0,i+=1),e.keyboard.backward&&(n+=0,i+=-1),e.keyboard.left&&(n+=-1,i+=0),e.keyboard.right&&(n+=1,i+=0),t.rotateAround(new o.ob,Math.atan2(n,i))}(t),a=Math.atan2(i.x,i.y);if(t.keyboard.space?(X.velocity.y=5,X.moveAction("jumping",a)):X.velocity.set(0,0,0),0!=t.touch.x&&0!=t.touch.y||t.keyboard.forward||t.keyboard.backward||t.keyboard.left||t.keyboard.right)if(t.keyboard.space)X.velocity.x=i.x/e,X.velocity.z=i.y/e;else{(n=X.getPosition().clone()).z+=i.y,n.x+=i.x;var c=new o.pb(n.x,n.y+1,n.z),r=new o.cb(c,new o.pb(0,-1,0),0,1).intersectObjects(f,!0);r.length>0&&(n.y=r[0].point.y+.01),X.isRunning()||("equipped"==X.bowState?X.moveAction("runWithBow"):X.isFiring()?X.moveAction("runWithLegsOnly"):X.moveAction("running"))}else if(X.isRunning()&&(X.isFiring()?X.anim[X.activeMovement].stop():X.moveAction("idle")),X.isFiring()){i=new o.pb;J.getWorldDirection(i),a=Math.atan2(i.x,i.z),X.getRotation().y=a,J.updateCamera(),X.broadcast()}}(n||X.velocity.x||X.velocity.y||X.velocity.z)&&(n||(n=X.getPosition()),n.add(X.velocity.clone().multiplyScalar(e)),X.move(n,a))},X.equipBow=function(){X.bowState="equipped",X.playBowAction("equipBow"),X.toggleBow(!0)},X.unequipBow=function(){X.toggleBow(!1),X.bowState="unequipped"},X.takeDamage=function(){me(),X.getPosition().y-=20},X.respawn=function(){X.getPosition().copy(new o.pb)},X.sendChat=function(e){F({player:Y,chatMessage:e})},X.equipBow(),X.moveAction("idle")});var U,G;window.innerWidth<window.innerHeight?(U=window.innerHeight,G=window.innerWidth):(U=window.innerWidth,G=window.innerHeight);var J=new o.U(75,U/G,.1,3e3);J.zoomState="out";const K=J.getFocalLength(),N=J.getFocalLength()+16;J.position.z=5;var _=new o.pb(0,1.5,0),Q=0,V=0;J.nextPosition=function(e){if(null!=X){var t=new o.pb;return t.x=_.x+e*Math.sin(Q*Math.PI/360)*Math.cos(V*Math.PI/360),t.y=_.y+e*Math.sin(V*Math.PI/360),t.z=_.z+e*Math.cos(Q*Math.PI/360)*Math.cos(V*Math.PI/360),t}},J.zoomIn=function(){J.zoomState="zooming in"},J.zoomOut=function(){J.zoomState="zooming out"},J.animate=function(e){if("zooming in"==J.zoomState)J.getFocalLength()<N&&((t=J.getFocalLength()+60*e)<N?J.setFocalLength(t):(J.setFocalLength(N),J.zoomState="in"));else if("zooming out"==J.zoomState){var t;if(J.getFocalLength()>K)(t=J.getFocalLength()-60*e)>K?J.setFocalLength(t):(J.setFocalLength(K),J.zoomState="out")}},J.setPosition=function(e){J.position.copy(e)},J.updateCamera=function(){if(null!=X){var e=X.getPosition().clone().sub(J.position.clone()),t=new o.pb(-e.z,0,e.x).normalize();_.copy(X.getPosition().clone().add(t)).setY(X.getPosition().y+1.5);var n=J.nextPosition(3.5),i=new o.cb(_,n.clone().sub(_).normalize(),0,3.5).intersectObjects(f,!0);i.length>0&&(n=i[0].point.clone().sub(n.clone().sub(i[0].point).normalize().multiplyScalar(.1))),J.setPosition(n)}J.lookAt(_),J.updateMatrix()},J.moveCamera=function(e,t){Q-=.2*e;var n=V+.2*t;135>=n&&n>=-80&&(V=n),J.updateCamera()},n.d(t,"start",function(){return xe}),n.d(t,"gameOver",function(){return me});var Z=new o.i;window.addEventListener("resize",function(){var e,t;e=window.innerWidth,t=window.innerHeight,ce&&window.innerWidth>window.innerHeight?(ce=!1,document.body.classList.remove("rotated")):ce?(e=window.innerHeight,t=window.innerWidth):window.innerWidth<window.innerHeight&&(fe(),e=window.innerHeight,t=window.innerWidth);S.setSize(e,t,!1),J.aspect=e/t,J.updateProjectionMatrix()});var $={keyboard:{forward:!1,backward:!1,left:!1,right:!1,space:!1},touch:{x:0,y:0}},ee="playing",te=!1,ne={id:null,x:null,y:null,shoot:!1},oe={id:null,x:null,y:null};const ie=4,ae=document.getElementById("shoot-button");var ce;function re(){requestAnimationFrame(re);var e=Z.getDelta();H(e),X&&I&&(X.animate(e,$),I.update(e)),Object.keys(E.all()).length&&function(e){Object.keys(P).forEach(t=>{P[t].mixer&&P[t].mixer.update(e)})}(e),J.animate(e),S.render(h,J)}function se(e,t){switch(e.key){case"w":$.keyboard.forward=t;break;case"a":$.keyboard.left=t;break;case"s":$.keyboard.backward=t;break;case"d":$.keyboard.right=t;break;case" ":$.keyboard.space=t}}function de(e){13===e.keyCode&&document.getElementById("chat").classList.contains("chatting")&&X.sendChat(document.getElementById("chat-text-box").value),se(e,!0)}function le(e){se(e,!1)}function ue(){"chat"==event.target.id?event.target.classList.add("chatting"):2!=event.button&&("paused"==ee?(document.body.requestPointerLock(),we()):"playing"==ee&&X.onMouseDown())}function pe(){"playing"===ee&&X.onMouseUp()}function we(){document.body.classList.remove("ready"),document.body.classList.add("playing"),ee="playing"}function me(){ee="gameOver",document.body.classList.remove("playing"),document.getElementById("title").innerHTML="Game over",document.body.classList.remove("playing"),document.body.classList.add("gameOver")}function ge(){ee=document.pointerLockElement?"playing":"paused"}function be(e){e!=te&&(e?ae.setAttribute("style","display: block;"):ae.setAttribute("style","display: none;"),te=e)}function ye(e){var t,n,o;e.preventDefault(),be(!0);for(var i=0;i<e.targetTouches.length;i++)e.targetTouches.item(i).identifier==ne.id?t=e.targetTouches.item(i):e.targetTouches.item(i).identifier==oe.id?n=e.targetTouches.item(i):null==o&&(o=e.targetTouches.item(i));t?(ce?J.moveCamera(ie*(t.pageY-ne.y),-1*ie*(t.pageX-ne.x)):J.moveCamera(ie*(t.pageX-ne.x),ie*(t.pageY-ne.y)),ne.x=t.pageX,ne.y=t.pageY):o&&("shoot-button"===o.target.id&&(X.onMouseDown(),ne.shoot=!0),(ce&&o.pageY>window.innerHeight/2||!ce&&o.pageX>window.innerWidth/2)&&(ne.id=o.identifier,ne.x=o.pageX,ne.y=o.pageY)),n?ce?($.touch.y=n.pageX-oe.x,$.touch.x=n.pageY-oe.y):($.touch.x=n.pageX-oe.x,$.touch.y=-1*(n.pageY-oe.y)):o&&(ce&&o.pageY<window.innerHeight/2||!ce&&o.pageX<window.innerWidth/2)&&(oe.id=o.identifier,oe.x=o.pageX,oe.y=o.pageY)}function ve(e){ne.id==e.changedTouches[0].identifier?(ne.shoot&&X.onMouseUp(),ne.id=null,ne.shoot=!1):oe.id==e.changedTouches[0].identifier&&(oe.id=null,$.touch={x:0,y:0})}function he(e){"shoot-button"!=e.target.id&&be(!1);var t=e.movementX||e.mozMovementX||e.webkitMovementX||0,n=e.movementY||e.mozMovementY||e.webkitMovementY||0;J.moveCamera(t,n)}function fe(){document.body.classList.add("rotated"),ce=!0}function xe(){document.addEventListener("mousemove",he),document.addEventListener("keydown",de),document.addEventListener("keyup",le),document.addEventListener("mousedown",ue),document.addEventListener("mouseup",pe),document.addEventListener("pointerlockchange",ge),document.addEventListener("touchstart",ye),document.addEventListener("touchmove",ye),document.addEventListener("touchend",ve),document.body.appendChild(S.domElement),window.innerWidth<window.innerHeight&&screen.orientation.type.includes("portrait")&&(document.body.requestFullscreen?document.body.requestFullscreen():document.body.mozRequestFullScreen?document.body.mozRequestFullScreen():document.body.webkitRequestFullscreen?document.body.webkitRequestFullscreen():document.body.msRequestFullscreen&&document.body.msRequestFullscreen(),fe()),re(),we()}document.getElementById("respawn").onclick=function(){X.respawn(),we()}},,,function(e,t,n){e.exports=n.p+"2fac3c8689875da451b1460bf44c6563.glb"},function(e,t,n){e.exports=n.p+"7892e5f13382f146373e2feee6999074.jpg"},function(e,t,n){e.exports=n.p+"bfbf6e3b2e9c92cee83c5cb73c602dff.jpg"},function(e,t,n){e.exports=n.p+"f900c2f67538e778beaa220d765ddb86.jpg"},function(e,t,n){e.exports=n.p+"dd72bb23dae86654c0018bf2164773ea.jpg"},function(e,t,n){e.exports=n.p+"40cb740f2b07e44047f4ca7823a46d21.jpg"},function(e,t,n){e.exports=n.p+"cf70fe3d246583aa691b7ff3fde1d03b.jpg"}]]);