(window.webpackJsonp=window.webpackJsonp||[]).push([[0],[,function(e,n,t){"use strict";t.r(n);var o=t(2),i=new(t(4).a),a=t(5),c=t.n(a),r=new o.fb,s=[];i.load(c.a,function(e){var n=e.scene;n.position.y-=10,r.add(n),s.push(n)});let d=[];d.push(new o.M({map:(new o.lb).load("../skybox/heather_ft.jpg")})),d.push(new o.M({map:(new o.lb).load("../skybox/heather_bk.jpg")})),d.push(new o.M({map:(new o.lb).load("../skybox/heather_up.jpg")})),d.push(new o.M({map:(new o.lb).load("../skybox/heather_dn.jpg")})),d.push(new o.M({map:(new o.lb).load("../skybox/heather_rt.jpg")})),d.push(new o.M({map:(new o.lb).load("../skybox/heather_lf.jpg")}));for(let e=0;e<6;e++)d[e].side=o.c;let l=new o.e(1e3,1e3,1e3),u=new o.L(l,d);var p;r.add(u),r.add(((p=new o.r(16777215,16777215,.6)).color.setHSL(.6,1,.6),p.groundColor.setHSL(.095,1,.75),p.position.set(0,50,0),p.visible=!0,p)),r.add(function(){var e=new o.l(16777215,1);e.color.setHSL(.1,1,.95),e.position.set(-1,1.75,1),e.position.multiplyScalar(30),e.castShadow=!0,e.shadow.mapSize.width=2048,e.shadow.mapSize.height=2048;return e.shadow.camera.left=-50,e.shadow.camera.right=50,e.shadow.camera.top=50,e.shadow.camera.bottom=-50,e.shadow.camera.far=3500,e.shadow.bias=-1e-4,e.visible=!0,e}());var w=new o.tb({antialias:!0,alpha:!0});function m(e,n){var t;return e.forEach(e=>{e.name!==n||(t=e)}),t}function b(e,n){n.mixer=e,n.actions={idle:e.clipAction(m(n.animations,"Idle")),running:e.clipAction(m(n.animations,"Running2")),runWithBow:e.clipAction(m(n.animations,"Run with bow")),runWithLegsOnly:e.clipAction(m(n.animations,"Running legs only")),jumping:e.clipAction(m(n.animations,"Jumping")).setLoop(o.H),equipBow:e.clipAction(m(n.animations,"Equip Bow")).setLoop(o.H),drawBow:e.clipAction(m(n.animations,"Draw bow")).setLoop(o.H),fireBow:e.clipAction(m(n.animations,"Fire bow")).setLoop(o.H)},n.actions.drawBow.clampWhenFinished=!0,n.toggleBow=function(e){n.scene.children[0].children[1].visible=!e,n.scene.children[0].children[2].visible=e},n.movementAction=function(e="idle"){if(n.actions&&n.actions[e]){if(n.activeMovement){if(n.activeMovement==e)return;n.actions[n.activeMovement].stop()}n.actions[e].reset().play(),n.activeMovement=e}else console.error("action: "+e+" does not exist!")},n.isRunning=function(){return!!n.activeMovement&&n.activeMovement.toLowerCase().includes("run")},n.isFiring=function(){return n.bowState&&("drawn"==n.bowState||"drawing"==n.bowState||"firing"==n.bowState)}}w.setClearColor("#e5e5e5"),w.setPixelRatio(window.devicePixelRatio),w.setSize(window.innerWidth,window.innerHeight),w.gammaOutput=!0,w.gammaFactor=2.2;var y=t(3),v=t.n(y);const h=new WebSocket("ws://ec2-18-191-136-250.us-east-2.compute.amazonaws.com:18181");function g(e){h.send(JSON.stringify(e))}h.onopen=function(){g({message:"sup fucker"})},h.onmessage=function(e){var n,t;if((e=JSON.parse(e.data)).players&&f.init(e.players),e.player){var i=e.player;i==O?e.damage&&E.takeDamage(e.damage):f.get(i)?"disconnected"===e.status?(r.remove(f.get(i).scene),f.get(i)):f.get(i).scene&&null!=e.x&&null!=e.y&&null!=e.z&&null!=e.rotation&&e.movementAction&&f.move(i,new o.qb(e.x,e.y,e.z),e.rotation,e.movementAction,e.bowAction):f.add(i,new o.qb(e.x,e.y,e.z))}else e.arrow&&(n=e.arrow,(t=z(n.origin,n.rotation)).velocity=new o.qb(n.velocity.x,n.velocity.y,n.velocity.z),A.push(t),L(t,(Date.now()-n.timeOfShoot)/1e3))};var f={},x={},k=[];f.all=function(){return x},f.get=e=>x[e],f.add=function(e,n){x[e]="loading",i.load(v.a,function(t){x[e]=t,b(new o.b(t.scene),t),n&&f.move(e,n,0),r.add(t.scene);var i=new o.L(new o.e(.5,2,.5));i.position.y+=1,i.material.visible=!1,t.scene.add(i),i.playerUuid=e,k.push(i)})},f.init=function(e){Object.keys(e).forEach(n=>{f.add(n,new o.qb(e[n].x,e[n].y,e[n].z))})},f.move=function(e,n,t,o,i){var a=x[e];a.scene.position.copy(n),a.scene.rotation.y=t,o&&a.movementAction(o),i&&a.actions[i].reset().play()};var M=[],A=[],S=.06,q=.75;function z(e,n){var t=new o.e(S,S,q),i=new o.M({color:65280}),a=new o.L(t,i);return a.origin=e,a.position.copy(e),a.rotation.copy(n),r.add(a),a}function L(e,n){e.velocity.y-=9*n,e.position.add(e.velocity.clone().multiplyScalar(n))}function B(e){M.forEach(n=>{if(!n.stopped){L(n,e);var t=new o.qb(0,0,1);t.applyEuler(n.rotation).normalize();var i=n.position.clone().sub(n.origin).length()/2,a=new o.db(n.position,t,0,i),c=a.intersectObjects(k);if(c.length>0){var r=c.pop();n.position.copy(r.point),n.stopped=!0,function(e){g({player:e,damage:100})}(r.object.playerUuid)}(c=a.intersectObjects(s,!0)).length>0&&(n.position.copy(c.pop().point),n.stopped=!0)}}),A.forEach(n=>{L(n,e)})}var E,j,O="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var n=16*Math.random()|0;return("x"==e?n:3&n|8).toString(16)});const W=.12;i.load(v.a,e=>{(E=e).velocity=new o.qb,E.bowState="unequipped",r.add(e.scene),b(j=new o.b(e.scene),E),j.addEventListener("finished",e=>{"Draw bow"==e.action.getClip().name?E.bowState="drawn":("Fire bow"==e.action.getClip().name&&(E.bowState="equipped"),E.moveAction("idle"))}),E.falling=function(){var e=new o.qb(0,-1,0);e=e.clone().normalize();var n=new o.db(new o.qb(E.scene.position.x,E.scene.position.y+.9,E.scene.position.z),e).intersectObjects(s,!0);return!(n.length>0&&n[0].distance<=new o.y(new o.qb,e).distance())};E.collisionDetected=function(e){for(var n=-1;n<=1;n++)for(var t=-1;t<=1;t++){n*=.5,t*=.5;var i=new o.qb(n,1,t);i=i.clone().normalize();var a=new o.db(new o.qb(e.x,e.y,e.z),i).intersectObjects(s,!0);if(a.length>0&&a[0].distance<=new o.y(new o.qb,i).distance())return!0}return!1},E.moveAction=function(e){E.movementAction(e),E.broadcast()},E.playBowAction=function(e){E.isRunning()&&"runWithLegsOnly"!=E.activeMovement?E.moveAction("runWithLegsOnly"):E.activeMovement&&(E.actions[E.activeMovement].stop(),E.activeMovement=null),E.actions[e].reset().play(),E.bowAction=e,E.broadcast()},E.jump=function(){E.velocity.y=5,E.moveAction("jumping")},E.onMouseDown=function(){"unequipped"==E.bowState?E.equipBow():(E.playBowAction("drawBow"),E.bowState="drawing")},E.onMouseUp=function(){"drawn"==E.bowState?(E.playBowAction("fireBow"),E.actions.drawBow.stop(),function(){var e=E.scene.position.clone().add(new o.qb(0,1.5,0)),n=z(e,C.rotation),t=new o.db;t.setFromCamera({x:0,y:0},C);var i,a=t.intersectObjects(s.concat(k),!0);a.length>0?i=a[0].point.sub(e):(i=new o.qb,C.getWorldDirection(i)),n.velocity=i.normalize().multiplyScalar(60),M.push(n),g({arrow:{origin:n.position,rotation:n.rotation,velocity:n.velocity,timeOfShoot:Date.now()}})}(),E.bowState="firing"):"drawing"===E.bowState&&(E.actions.drawBow.stop(),E.bowState="equipped",E.moveAction("idle"))},E.broadcast=async function(){g({player:O,x:E.scene.position.x,y:E.scene.position.y,z:E.scene.position.z,rotation:E.scene.rotation.y,movementAction:E.activeMovement,bowAction:E.bowAction,bowState:E.bowState})},E.move=function(e,n=E.scene.rotation.y){if(E.collisionDetected(e))E.velocity.set(0,0,0);else{if(E.scene.position.copy(e),E.isFiring()){var t=new o.qb;C.getWorldDirection(t),n=Math.atan2(t.x,t.z),E.rotate(n)}E.scene.rotation.y=n,C.updateCamera(),E.broadcast()}},E.rotate=function(e){E.scene.rotation.y=e,E.broadcast()},E.animate=function(e,n){var t=new o.qb;if(E.falling())E.velocity.y-=10*e,t=E.scene.position.clone().add(E.velocity.clone().multiplyScalar(e)),E.move(t);else{E.velocity.set(0,0,0);var i=function(e){var n=new o.qb;C.getWorldDirection(n),(n=new o.pb(n.x,n.z)).normalize().multiplyScalar(W);var t=0,i=0;if(0!=e.touch.x&&0!=e.touch.y){var a=new o.pb(e.touch.x,e.touch.y).normalize();t=a.x,i=a.y}return e.keyboard.forward&&(t+=0,i+=1),e.keyboard.backward&&(t+=0,i+=-1),e.keyboard.left&&(t+=-1,i+=0),e.keyboard.right&&(t+=1,i+=0),n.rotateAround(new o.pb,Math.atan2(t,i))}(n),a=Math.atan2(i.x,i.y);if(n.keyboard.space&&E.jump(),0!=n.touch.x&&0!=n.touch.y||n.keyboard.forward||n.keyboard.backward||n.keyboard.left||n.keyboard.right){t.z=E.scene.position.z+i.y,t.x=E.scene.position.x+i.x,E.velocity.x=(t.x-E.scene.position.x)/e,E.velocity.z=(t.z-E.scene.position.z)/e,t.y=E.scene.position.y;var c=new o.qb(t.x,t.y+1,t.z),r=new o.db(c,new o.qb(0,-1,0)).intersectObjects(s,!0);r.length>0&&(t.y=r[0].point.y+.01),E.move(t,a),E.isRunning()||("equipped"==E.bowState?E.moveAction("runWithBow"):E.isFiring()?E.moveAction("runWithLegsOnly"):E.moveAction("running"))}else E.isRunning()&&E.moveAction("idle");n.keyboard.space&&(t=E.scene.position.clone().add(E.velocity.clone().multiplyScalar(e)),E.move(t))}},E.equipBow=function(){E.bowState="equipped",E.playBowAction("equipBow"),E.toggleBow(!0)},E.unequipBow=function(){E.toggleBow(!1),E.bowState="unequipped"},E.takeDamage=function(){E.scene.position.y-=20},E.unequipBow(),E.moveAction("idle")});var C=new o.V(75,window.innerWidth/window.innerHeight,.1,3e3);C.position.z=5;var D=new o.qb(0,1,0),P=0,H=0;C.nextPosition=function(e){if(null!=E){var n=new o.qb;return n.x=D.x+e*Math.sin(P*Math.PI/360)*Math.cos(H*Math.PI/360),n.y=D.y+e*Math.sin(H*Math.PI/360),n.z=D.z+e*Math.cos(P*Math.PI/360)*Math.cos(H*Math.PI/360),n}},C.setPosition=function(e){C.position.copy(e)},C.updateCamera=function(){if(null!=E){var e=E.scene.position.clone().sub(C.position.clone()),n=new o.qb(-e.z,0,e.x).normalize();D.copy(E.scene.position.clone().add(n)).setY(E.scene.position.y+1);var t=C.nextPosition(3.5),i=new o.db(D,t.clone().sub(D).normalize(),0,5).intersectObjects(s,!0);i.length>0&&(t=i[0].point.clone().sub(t.clone().sub(i[0].point).normalize().multiplyScalar(.1))),C.setPosition(t)}C.lookAt(D),C.updateMatrix()},C.moveCamera=function(e,n){P-=.2*e;var t=H+.2*n;135>=t&&t>=-80&&(H=t),C.updateCamera()},t.d(n,"start",function(){return oe});var X=new o.i;document.body.appendChild(w.domElement),window.addEventListener("resize",function(){w.setSize(window.innerWidth,window.innerHeight),C.aspect=window.innerWidth/window.innerHeight,C.updateProjectionMatrix()});var F={keyboard:{forward:!1,backward:!1,left:!1,right:!1,space:!1},touch:{x:0,y:0}},R="ready",Y=!1,T={id:null,x:null,y:null,shoot:!1},I={id:null,x:null,y:null};function _(){requestAnimationFrame(_);var e=X.getDelta();B(e),E&&j&&(E.animate(e,F),j.update(e)),Object.keys(f.all()).length&&function(e){Object.keys(x).forEach(n=>{x[n].mixer&&x[n].mixer.update(e)})}(e),w.render(r,C)}function J(e,n){switch(e.key){case"w":F.keyboard.forward=n;break;case"a":F.keyboard.left=n;break;case"s":F.keyboard.backward=n;break;case"d":F.keyboard.right=n;break;case" ":F.keyboard.space=n}}function U(e){J(e,!0)}function N(e){J(e,!1)}function V(){"playing"===R&&E.onMouseDown()}function G(){"playing"===R&&E.onMouseUp()}function K(){"playing"!==R&&(document.body.requestPointerLock(),R="playing")}function Q(){document.pointerLockElement||(R="ready")}function Z(e){e!=Y&&(e?shootButton.setAttribute("style","display: block;"+te):shootButton.setAttribute("style","display: none;"+te),Y=e)}function $(e){var n,t,o;e.preventDefault(),Z(!0);for(var i=0;i<e.targetTouches.length;i++)e.targetTouches.item(i).identifier==T.id?n=e.targetTouches.item(i):e.targetTouches.item(i).identifier==I.id?t=e.targetTouches.item(i):null==o&&(o=e.targetTouches.item(i));n?(C.moveCamera(4*(n.pageX-T.x),4*(n.pageY-T.y)),T.x=n.pageX,T.y=n.pageY):o&&("shootButton"===o.target.id&&(E.onMouseDown(),T.shoot=!0),o.pageX>window.innerWidth/2&&(T.id=o.identifier,T.x=o.pageX,T.y=o.pageY)),t?(F.touch.x=t.pageX-I.x,F.touch.y=-1*(t.pageY-I.y)):o&&o.pageX<window.innerWidth/2&&(I.id=o.identifier,I.x=o.pageX,I.y=o.pageY)}function ee(e){T.id==e.changedTouches[0].identifier?(T.shoot&&E.onMouseUp(),T.id=null,T.shoot=!1):I.id==e.changedTouches[0].identifier&&(I.id=null,F.touch={x:0,y:0})}function ne(e){"shootButton"!=e.target.id&&Z(!1);var n=e.movementX||e.mozMovementX||e.webkitMovementX||0,t=e.movementY||e.mozMovementY||e.webkitMovementY||0;C.moveCamera(n,t)}const te="position: fixed; top: 50%; left: 85%; width: 50px; height: 50px; background-image: url(dot-and-circle.svg);";function oe(){document.addEventListener("mousemove",ne),document.addEventListener("keydown",U),document.addEventListener("keyup",N),document.addEventListener("click",K),document.addEventListener("mousedown",V),document.addEventListener("mouseup",G),document.addEventListener("pointerlockchange",Q),document.addEventListener("touchstart",$),document.addEventListener("touchmove",$),document.addEventListener("touchend",ee),_();var e=document.createElement("div");e.setAttribute("style","position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 30px; height: 30px; background-image: url(crosshair.svg);"),document.body.appendChild(e);var n=document.createElement("div");n.setAttribute("id","shootButton"),n.setAttribute("style","display: none;"+te),document.body.appendChild(n)}},,function(e,n,t){e.exports=t.p+"aaa61a2e8305b0eb326a110017161ff0.glb"},,function(e,n,t){e.exports=t.p+"baae041779d88e3f44e7b73d83d4b782.glb"}]]);